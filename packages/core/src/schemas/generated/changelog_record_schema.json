{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "changelog_record_schema.json",
  "title": "ChangelogRecord",
  "description": "Canonical schema for changelog records - Enterprise Grade System Historian",
  "additionalProperties": false,
  "type": "object",
  "required": [
    "id",
    "entityType",
    "entityId",
    "changeType",
    "title",
    "description",
    "timestamp",
    "trigger",
    "triggeredBy",
    "reason",
    "riskLevel"
  ],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^\\d{10}-changelog-[a-z]+-[a-z0-9-]{1,50}$",
      "description": "Unique identifier for the changelog entry"
    },
    "entityType": {
      "type": "string",
      "enum": [
        "task",
        "cycle",
        "agent",
        "system",
        "configuration"
      ],
      "description": "Type of the primary entity that changed"
    },
    "entityId": {
      "type": "string",
      "description": "ID of the primary entity that changed"
    },
    "changeType": {
      "type": "string",
      "enum": [
        "creation",
        "completion",
        "update",
        "deletion",
        "hotfix"
      ],
      "description": "The nature of the change"
    },
    "title": {
      "type": "string",
      "minLength": 10,
      "maxLength": 150,
      "description": "Executive title of the change"
    },
    "description": {
      "type": "string",
      "minLength": 20,
      "maxLength": 5000,
      "description": "Detailed description of the change and its impact"
    },
    "timestamp": {
      "type": "number",
      "minimum": 0,
      "description": "Unix timestamp in seconds when the change occurred"
    },
    "trigger": {
      "type": "string",
      "enum": [
        "manual",
        "automated",
        "emergency"
      ],
      "description": "How the change was initiated"
    },
    "triggeredBy": {
      "type": "string",
      "description": "Actor or agent ID that initiated the change"
    },
    "reason": {
      "type": "string",
      "minLength": 10,
      "maxLength": 1000,
      "description": "Why the change was made"
    },
    "riskLevel": {
      "type": "string",
      "enum": [
        "low",
        "medium",
        "high",
        "critical"
      ],
      "description": "Risk level of the change"
    },
    "affectedSystems": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "IDs of systems impacted by this change"
    },
    "usersAffected": {
      "type": "number",
      "minimum": 0,
      "description": "Number of users impacted by this change"
    },
    "downtime": {
      "type": "number",
      "minimum": 0,
      "description": "Downtime in seconds caused by this change"
    },
    "files": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "List of main files that were created or modified"
    },
    "commits": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "List of git commit hashes related to this change"
    },
    "rollbackInstructions": {
      "type": "string",
      "minLength": 20,
      "maxLength": 2000,
      "description": "Step-by-step instructions to rollback this change"
    },
    "references": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "tasks": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "IDs of related TaskRecords"
        },
        "cycles": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "IDs of related CycleRecords"
        },
        "executions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "IDs of related ExecutionRecords"
        },
        "changelogs": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "IDs of related ChangelogRecords"
        }
      },
      "description": "Cross-references to other GitGovernance records"
    }
  },
  "examples": [
    {
      "id": "1752707800-changelog-task-user-dashboard",
      "entityType": "task",
      "entityId": "1752274500-task-user-dashboard",
      "changeType": "completion",
      "title": "User Dashboard Implementation Completed",
      "description": "Responsive dashboard with real-time analytics, user preferences, and notification center. All acceptance criteria met with 95% test coverage.",
      "timestamp": 1752707800,
      "trigger": "manual",
      "triggeredBy": "human:senior-dev",
      "reason": "All acceptance criteria met, code review passed, ready for production",
      "riskLevel": "low",
      "files": [
        "src/pages/Dashboard.tsx",
        "src/components/Analytics.tsx"
      ],
      "commits": [
        "abc123def",
        "456ghi789"
      ],
      "references": {
        "tasks": [
          "1752274500-task-user-dashboard"
        ],
        "executions": [
          "1752707750-exec-dashboard-implementation"
        ]
      }
    },
    {
      "id": "1752707900-changelog-system-payment-gateway",
      "entityType": "system",
      "entityId": "payment-gateway",
      "changeType": "hotfix",
      "title": "Critical Payment Timeout Fix",
      "description": "Fixed 15% payment failure rate by increasing timeout from 5s to 30s and adding circuit breaker pattern. Emergency response to third-party API latency spike.",
      "timestamp": 1752707900,
      "trigger": "emergency",
      "triggeredBy": "human:on-call-engineer",
      "reason": "Payment failures spiked to 15% due to third-party API latency increase",
      "riskLevel": "critical",
      "affectedSystems": [
        "payment-gateway",
        "order-service",
        "notification-service"
      ],
      "usersAffected": 25000,
      "downtime": 0,
      "rollbackInstructions": "1. Revert to payment-gateway:v2.1.4\n2. kubectl rollout restart deployment/payment-gateway\n3. Monitor success rate for 10 minutes",
      "commits": [
        "abc123def"
      ]
    }
  ]
}