{
  "header": {
    "version": "1.0",
    "type": "task",
    "payloadChecksum": "e535da189a41424198de3e78a0a1bcb8e623405545d80522483ec6aad423f3f2",
    "signatures": [
      {
        "keyId": "human:camilo",
        "role": "author",
        "notes": "Signature regenerated by lint --fix",
        "signature": "+7tkj1WtXLkGS6YVcqS1MF/3mzXdDzXRJX9UG1oYDrE7+tsmzpou3Fr++U3w0miUYqmeBH0hG4wUiCxBbca3DA==",
        "timestamp": 1762658229
      },
      {
        "keyId": "human:camilo-v2",
        "role": "author",
        "notes": "Record signed",
        "signature": "DjEmS6GF5FPFGmjn+QCinQaXzQl/Vm+euXGXJc8GFcWmhUkPLWuCjOizQhpKTF9hmVnO92C4k1JWFSip+51iBQ==",
        "timestamp": 1763344818
      }
    ]
  },
  "payload": {
    "id": "1761740113-task-wrap-workflowmethodologyrecord-in-embeddedmetadata",
    "title": "Wrap WorkflowMethodologyRecord in EmbeddedMetadata for audit trail",
    "status": "draft",
    "priority": "low",
    "description": "# Wrap WorkflowMethodologyRecord in EmbeddedMetadata\n\n## Context\nCurrently `WorkflowMethodologyRecord` is stored as plain YAML config without audit trail, signatures, or versioning. This creates an architectural inconsistency with all other Records and lacks governance controls.\n\n## Problem\n- No signature verification for methodology changes\n- No audit trail of who modified what and when\n- No checksum integrity validation\n- Inconsistent architecture (only Record type not wrapped in EmbeddedMetadata)\n\n## Proposed Solution\nWrap `WorkflowMethodologyRecord` in `EmbeddedMetadata` (like all other 7 Records) to enable:\n1. **Signature verification** for methodology changes\n2. **Audit trail** of modifications (who, when, what)\n3. **Checksum integrity** validation\n4. **Consistent architecture** across all Records\n\n## Technical Scope\n\n### Files to Modify/Create (~12-15 files)\n1. **Validator** (~30 lines)\n   - Add `validateFullWorkflowMethodologyRecord` with EARS 1-4\n   - Update tests with EARS 1-4 coverage\n\n2. **Factory** (new file ~80 lines)\n   - Create `createWorkflowMethodologyRecord`\n   - Uses `createEmbeddedMetadataRecord` internally\n   - Full test coverage\n\n3. **ConfigManager** (~50 lines)\n   - Backward compatibility for existing YAML files\n   - Detect format (old vs new)\n   - Handle both transparently\n\n4. **CLI** (~40 lines)\n   - Auto-wrap on save\n   - Auto-unwrap on load\n   - Maintain UX consistency\n\n5. **Integration Tests** (new file ~100 lines)\n   - Test migration path\n   - Test backward compatibility\n   - Test new workflow\n\n## Challenges\n\n### ðŸ”´ CRITICAL: Backward Compatibility\n- Existing `.gitgov/workflow_methodology.yaml` files must continue working without changes\n- ConfigManager must detect format and handle both\n- Migration must be transparent to users\n\n### Strategy\n```typescript\n// ConfigManager: Detect format\nfunction loadWorkflowMethodology(): WorkflowMethodologyRecord {\n  const raw = readYAML('.gitgov/workflow_methodology.yaml');\n  \n  // New format: has header + payload\n  if (raw.header && raw.payload) {\n    await validateFullWorkflowMethodologyRecord(raw, getPublicKey);\n    return raw.payload;\n  }\n  \n  // Old format: plain config\n  validateWorkflowMethodologyConfigDetailed(raw);\n  return raw;\n}\n```\n\n## Acceptance Criteria\n- [ ] `validateFullWorkflowMethodologyRecord` implements EARS 1-4\n- [ ] Factory creates properly signed `WorkflowMethodologyRecord`\n- [ ] ConfigManager loads both old and new formats transparently\n- [ ] CLI wraps on save, unwraps on load\n- [ ] All existing projects continue working without changes\n- [ ] Integration tests cover migration path (old â†’ new)\n- [ ] Documentation updated (blueprint + CLI docs)\n- [ ] All 133+ existing tests continue passing\n\n## Estimated Effort\n**2-3 days** of focused work (~17-20 hours)\n\n## References\n- `validator_module.md` - Generic EARS 1-16 specification\n- `execution_validator.ts` - Reference implementation for Records with EmbeddedMetadata\n- `task_validator.ts` - Another reference implementation\n- `workflow_methodology_validator.ts` - Current implementation (no EmbeddedMetadata)\n\n## Tags\narchitecture, consistency, governance, audit-trail, signatures\n\n## Priority\nMedium (Important for architecture consistency, but existing system works)",
    "tags": [
      "architecture",
      "consistency",
      "governance",
      "audit-trail",
      "signatures"
    ],
    "references": [],
    "cycleIds": [
      "1763344784-cycle-tareas-hurfanas-consolidadas"
    ]
  }
}