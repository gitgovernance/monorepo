{
  "header": {
    "version": "1.0",
    "type": "task",
    "payloadChecksum": "53f19dff97d158babfb6b16785a93ff3e76a689f75428e96058d67956467e836",
    "signatures": [
      {
        "keyId": "human:camilo-v2",
        "role": "author",
        "notes": "Record signed",
        "signature": "2GzGowfoEHIT1UgwJF3lfMXgph2jd/c7cm0yarFq/eP51ZdDW9ITjvA9ENwKybCfCTQkm2dXhn/EnmSUxghWDg==",
        "timestamp": 1763380969
      },
      {
        "keyId": "human:camilo-v2",
        "role": "author",
        "notes": "Record signed",
        "signature": "u5OlRLtfbyOmC3h2hbZTr5bQoHigEknz0YXGuqEQ83SpLa73RPUi9/wAnprHjtsIu2XFYL4gL0S8+Tux0w7GDQ==",
        "timestamp": 1763380969
      },
      {
        "keyId": "human:camilo-v2",
        "role": "author",
        "notes": "Record signed",
        "signature": "3rvm+rY9i1oEVDduOS7xHFhe1DZ2SVKehj/goggmpqyZSNE/6r26aabGKgaAPv8qZYhIPuU2BMOcY25OgiTNCA==",
        "timestamp": 1763381824
      },
      {
        "keyId": "human:camilo-v2",
        "role": "author",
        "notes": "Record signed",
        "signature": "WcALe054nEtB0bsZ+Qh4rvngaeChJeeQeUhzAp3qhsHighT3HPMWrBewDlxXe9R9zHou7YJ1W+/zcH8E623GCA==",
        "timestamp": 1763381844
      }
    ]
  },
  "payload": {
    "id": "1763380969-task-implement-notes-field-support-in-task-cli-commands",
    "title": "Implement notes field support in task CLI commands",
    "status": "draft",
    "priority": "medium",
    "description": "# Implement notes field support in task commands\n\n## üìã Problema Identificado\n\nEl schema `task_record_schema.yaml` define el campo `notes` (l√≠neas 92-96):\n\n```yaml\nnotes:\n  type: string\n  minLength: 0\n  maxLength: 3000\n  description: \"Additional comments, decisions made or added context\"\n```\n\nY el tipo TypeScript generado `TaskRecord` incluye:\n\n```typescript\n/**\n * Additional comments, decisions made or added context\n */\nnotes?: string;\n```\n\n**PERO** los comandos CLI no soportan operar con este campo:\n\n- ‚ùå `gitgov task new` - No tiene flag `--notes`\n- ‚ùå `gitgov task edit` - No tiene flag `--notes`\n- ‚ùå `gitgov task show` - No muestra el campo notes (si existe)\n\n---\n\n## üéØ Objetivo\n\nImplementar soporte completo para el campo `notes` en todos los comandos task relevantes.\n\n---\n\n## üì¶ Entregables\n\n### 1. `gitgov task new` - Agregar flag `--notes`\n\n**Cambio en CLI:**\n\n```typescript\n// commands/task/task-new.ts\n\nprogram\n  .command('new')\n  .option('-n, --notes <notes>', 'Additional comments or context (max 3000 chars)')\n  // ... otros flags\n```\n\n**Validaci√≥n:**\n\n```typescript\n// Validar longitud m√°xima\nif (options.notes && options.notes.length > 3000) {\n  throw new Error('Notes must be 3000 characters or less');\n}\n```\n\n**Uso:**\n\n```bash\n# Crear task con notes\ngitgov task new \"Implement feature X\" \\\n  --priority high \\\n  --notes \"Discussed with team: prefer approach B over A due to performance\"\n\n# Crear task con notes multil√≠nea (usando heredoc)\ngitgov task new \"Fix bug Y\" <<EOF\n--notes \"Root cause: race condition in async handler\nTested fix locally: works in 100/100 iterations\nNeeds review from @senior-dev before merge\"\nEOF\n```\n\n---\n\n### 2. `gitgov task edit` - Agregar flag `--notes`\n\n**Cambio en CLI:**\n\n```typescript\n// commands/task/task-edit.ts\n\nprogram\n  .command('edit')\n  .option('-n, --notes <notes>', 'Update task notes')\n  .option('--append-notes <notes>', 'Append to existing notes')\n  .option('--clear-notes', 'Clear task notes')\n  // ... otros flags\n```\n\n**Comportamiento:**\n\n```bash\n# Reemplazar notes completamente\ngitgov task edit 1763344404-task-foo --notes \"New notes text\"\n\n# Agregar al final de notes existentes (√∫til para registro cronol√≥gico)\ngitgov task edit 1763344404-task-foo --append-notes \"\n[2025-11-17] Updated after review: approved by tech lead\n\"\n\n# Limpiar notes\ngitgov task edit 1763344404-task-foo --clear-notes\n```\n\n---\n\n### 3. `gitgov task show` - Mostrar campo notes\n\n**Cambio en output:**\n\n```typescript\n// commands/task/task-show.ts\n\n// Agregar secci√≥n de notes si existe\nif (task.notes && task.notes.trim().length > 0) {\n  console.log(`\\nüìù Notes:\\n${task.notes}`);\n}\n```\n\n**Output esperado:**\n\n```bash\n$ gitgov task show 1763344404-task-foo\n\nüìã Task: 1763344404-task-foo\nüìù Title: Implement feature X\nüìä Status: active\n‚ö° Priority: high\nüìÑ Description: Implement OAuth flow...\n\nüìù Notes:\n[2025-11-15] Initial discussion with team\nApproach B selected over A due to performance concerns\nNeed to coordinate with backend team for API changes\n\n[2025-11-17] Updated after review\nTech lead approved implementation plan\nProceed with Cycle 01 tasks\n```\n\n---\n\n### 4. Validaci√≥n en BacklogAdapter\n\n**Agregar validaci√≥n:**\n\n```typescript\n// adapters/backlog_adapter/index.ts\n\nasync createTask(data: Partial<TaskRecord>): Promise<TaskRecord> {\n  // ... validaciones existentes\n  \n  // Validar notes si est√° presente\n  if (data.notes !== undefined) {\n    if (typeof data.notes !== 'string') {\n      throw new Error('Task notes must be a string');\n    }\n    if (data.notes.length > 3000) {\n      throw new DetailedValidationError(\n        'Notes exceeds maximum length',\n        [{ field: 'notes', message: 'Must be 3000 characters or less', value: data.notes.length }]\n      );\n    }\n  }\n  \n  // ... resto del c√≥digo\n}\n```\n\n---\n\n## üß™ Tests Necesarios\n\n### Test 1: task new con notes\n\n```typescript\ndescribe('gitgov task new --notes', () => {\n  it('should create task with notes field', async () => {\n    const result = await executeCommand([\n      'task', 'new', 'Test task',\n      '--notes', 'This is a test note'\n    ]);\n    \n    const task = await backlogAdapter.getTask(result.taskId);\n    expect(task.notes).toBe('This is a test note');\n  });\n  \n  it('should reject notes longer than 3000 chars', async () => {\n    const longNotes = 'a'.repeat(3001);\n    \n    await expect(\n      executeCommand(['task', 'new', 'Test', '--notes', longNotes])\n    ).rejects.toThrow('Notes must be 3000 characters or less');\n  });\n});\n```\n\n### Test 2: task edit con notes\n\n```typescript\ndescribe('gitgov task edit --notes', () => {\n  it('should update task notes', async () => {\n    const task = await createTestTask({ notes: 'Original notes' });\n    \n    await executeCommand([\n      'task', 'edit', task.id,\n      '--notes', 'Updated notes'\n    ]);\n    \n    const updated = await backlogAdapter.getTask(task.id);\n    expect(updated.notes).toBe('Updated notes');\n  });\n  \n  it('should append to existing notes with --append-notes', async () => {\n    const task = await createTestTask({ notes: 'Line 1' });\n    \n    await executeCommand([\n      'task', 'edit', task.id,\n      '--append-notes', '\\nLine 2'\n    ]);\n    \n    const updated = await backlogAdapter.getTask(task.id);\n    expect(updated.notes).toBe('Line 1\\nLine 2');\n  });\n  \n  it('should clear notes with --clear-notes', async () => {\n    const task = await createTestTask({ notes: 'To be deleted' });\n    \n    await executeCommand([\n      'task', 'edit', task.id,\n      '--clear-notes'\n    ]);\n    \n    const updated = await backlogAdapter.getTask(task.id);\n    expect(updated.notes).toBe('');\n  });\n});\n```\n\n### Test 3: task show muestra notes\n\n```typescript\ndescribe('gitgov task show', () => {\n  it('should display notes section if present', async () => {\n    const task = await createTestTask({\n      notes: 'Important context here'\n    });\n    \n    const output = await executeCommandWithOutput(['task', 'show', task.id]);\n    \n    expect(output).toContain('üìù Notes:');\n    expect(output).toContain('Important context here');\n  });\n  \n  it('should not display notes section if empty', async () => {\n    const task = await createTestTask({ notes: '' });\n    \n    const output = await executeCommandWithOutput(['task', 'show', task.id]);\n    \n    expect(output).not.toContain('üìù Notes:');\n  });\n});\n```\n\n---\n\n## üìù Casos de Uso\n\n### Caso 1: Registro de decisiones t√©cnicas\n\n```bash\n# Durante planificaci√≥n\ngitgov task new \"Migrate to Postgres\" \\\n  --notes \"Team discussion 2025-11-15:\n- Evaluated MySQL vs Postgres\n- Postgres chosen for better JSON support\n- Migration estimated at 3 sprints\"\n\n# Despu√©s de research\ngitgov task edit 1763344404-task-migrate --append-notes \"\n[2025-11-17] POC completed successfully\n- JSON queries 30% faster than MySQL\n- Migration scripts tested on staging\"\n```\n\n### Caso 2: Contexto de bug fixes\n\n```bash\ngitgov task new \"Fix memory leak in indexer\" \\\n  --priority critical \\\n  --notes \"Discovered in production monitoring\nAffects only long-running processes (>24h uptime)\nEventEmitter listeners not cleaned up properly\nCustomer impact: 2 enterprise clients\"\n```\n\n### Caso 3: Coordinaci√≥n entre equipos\n\n```bash\ngitgov task new \"Implement OAuth flow\" \\\n  --notes \"Backend team dependencies:\n- Need /oauth/callback endpoint ready by Nov 20\n- JWT validation library must support RS256\nBlocked by: task-1763344400-api-endpoints\"\n```\n\n### Caso 4: Registro de cambios durante ejecuci√≥n\n\n```bash\n# Al iniciar\ngitgov task activate 1763344404-task-foo\n\n# Durante implementaci√≥n\ngitgov task edit 1763344404-task-foo --append-notes \"\n[2025-11-17 10:00] Started implementation\nApproach: Using passport.js instead of from-scratch\n\"\n\n# Despu√©s de blocker\ngitgov task edit 1763344404-task-foo --append-notes \"\n[2025-11-17 14:00] Blocked: Missing API key\nContacted ops team, ETA 2 hours\n\"\n\n# Al completar\ngitgov task edit 1763344404-task-foo --append-notes \"\n[2025-11-17 16:30] Completed and tested\nPR #123 submitted for review\n\"\n```\n\n---\n\n## ‚úÖ Criterios de Aceptaci√≥n\n\n- [ ] `gitgov task new --notes <text>` crea task con notes\n- [ ] `gitgov task edit <id> --notes <text>` actualiza notes (reemplaza)\n- [ ] `gitgov task edit <id> --append-notes <text>` agrega al final\n- [ ] `gitgov task edit <id> --clear-notes` limpia notes\n- [ ] `gitgov task show <id>` muestra notes si existe\n- [ ] Validaci√≥n: m√°ximo 3000 caracteres\n- [ ] Validaci√≥n: tipo string\n- [ ] Tests: 100% cobertura de nuevas funcionalidades\n- [ ] Documentaci√≥n: ejemplos de uso en task_command.md\n- [ ] Backward compatible: tasks sin notes siguen funcionando\n\n---\n\n## üîó Referencias\n\n- `packages/blueprints/03_products/protocol/04_task/task_record_schema.yaml` (l√≠neas 92-96)\n- `packages/core/src/types/generated/task_record.ts` (l√≠nea 46)\n- `packages/cli/src/commands/task/task-new.ts` - Comando a modificar\n- `packages/cli/src/commands/task/task-edit.ts` - Comando a modificar\n- `packages/cli/src/commands/task/task-show.ts` - Comando a modificar\n- `packages/core/src/adapters/backlog_adapter/index.ts` - Validaci√≥n\n\n---\n\n## üìä Estimaci√≥n\n\n**Complejidad:** Baja  \n**Tiempo estimado:** 2-3 horas  \n**Impacto:** Medio (mejora UX para registro de contexto)\n\n**Desglose:**\n- CLI flags (task new, task edit): 30 min\n- Display en task show: 15 min\n- Validaci√≥n en BacklogAdapter: 15 min\n- Tests (3 suites): 1 hora\n- Documentaci√≥n y ejemplos: 30 min\n- Testing manual: 15 min\n\n---\n\n## üí° Mejoras Futuras (opcional)\n\n### 1. Formato de notes estructurado\n\n```bash\n# Template de notes con secciones\ngitgov task new \"Task X\" --notes-template decision\n\n# Genera:\n# ## Context\n# \n# ## Decision\n# \n# ## Consequences\n# \n# ## Alternatives Considered\n```\n\n### 2. Notes con timestamps autom√°ticos\n\n```bash\n# Flag --append-notes-with-timestamp\ngitgov task edit <id> --append-notes-with-timestamp \"Completed review\"\n\n# Genera:\n# [2025-11-17 14:30:25] Completed review\n```\n\n### 3. Buscar en notes\n\n```bash\n# Buscar tasks por contenido de notes\ngitgov task list --search-notes \"postgres\"\n```\n\n---\n\n## üè∑Ô∏è Tags Sugeridos\n\n- `category:enhancement`\n- `package:cli`\n- `package:core`\n- `skill:typescript`\n- `priority:medium`\n- `effort:small`",
    "tags": [
      "category:enhancement",
      "package:cli",
      "package:core",
      "skill:typescript"
    ],
    "references": [
      "file:packages/blueprints/03_products/protocol/04_task/task_record_schema.yaml",
      "file:packages/core/src/types/generated/task_record.ts",
      "file:packages/cli/src/commands/task/task-new.ts",
      "file:packages/cli/src/commands/task/task-edit.ts",
      "file:packages/cli/src/commands/task/task-show.ts"
    ],
    "cycleIds": [
      "1763344784-cycle-tareas-hurfanas-consolidadas"
    ]
  }
}