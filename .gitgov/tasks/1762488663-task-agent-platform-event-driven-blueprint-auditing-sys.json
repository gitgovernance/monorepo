{
  "header": {
    "version": "1.0",
    "type": "task",
    "payloadChecksum": "223977561403316b3e49be961d36c7312c40e3d6dc7bbe6520cfd8fda5e0c847",
    "signatures": [
      {
        "keyId": "human:camilo",
        "role": "author",
        "notes": "Task created",
        "signature": "HpTC0Q4m6nzAy9ol8k61GKwm2mXGX9KZKB/BeQn3IUzbs9kuNsiA8SXVHK6MrUd3ttDNjU9igcVLG416oK0jDQ==",
        "timestamp": 1762658229
      },
      {
        "keyId": "human:camilo-v2",
        "role": "author",
        "notes": "Record signed",
        "signature": "bsumIO7u1MypBl3I6vEA8G0rNkZygWS72vPnUEQtHljRIl/A6Y5hkgCxTeC+6zqCDQLS35JJl+zmb/dWateCCQ==",
        "timestamp": 1763344818
      }
    ]
  },
  "payload": {
    "id": "1762488663-task-agent-platform-event-driven-blueprint-auditing-sys",
    "title": "Agent Platform: Event-Driven Blueprint Auditing System",
    "status": "draft",
    "priority": "high",
    "description": "# Agent Platform: Event-Driven Blueprint Auditing System\n\n## ğŸ¯ Contexto\n\nCrear un **sistema de agentes especializados** que auditen blueprints automÃ¡ticamente usando los estÃ¡ndares v2 (cli_designer_v2.md, module_designer_v2.md), reaccionando a FeedbackRecords del protocolo GitGovernance.\n\n**Valor:**\n- âœ… Automatiza auditorÃ­a de blueprints (manual â†’ <2 minutos)\n- âœ… Aplica 5 criterios objetivos consistentemente\n- âœ… Usa protocolo existente (FeedbackRecord + AgentRecord)\n- âœ… Extensible para futuros agentes especializados\n\n---\n\n## ğŸ“‹ Problema\n\n**Estado Actual:** Review manual de blueprints toma 30-60 minutos, inconsistente entre reviewers.\n\n**Estado Deseado:** \n1. Humano crea FeedbackRecord: `\"Audita blueprint X\"`\n2. AgentWatcher detecta feedback asignado a `agent:cli-designer`\n3. Agente ejecuta auditorÃ­a automÃ¡tica (5 criterios)\n4. Genera reporte con scoring (X.X/10) y gaps\n5. Crea FeedbackRecord respuesta\n6. **Tiempo: <2 minutos**\n\n---\n\n## ğŸ—ï¸ Arquitectura\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   GitGovernance Agent Platform          â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  1. AgentWatcher (chokidar event loop) â”‚\nâ”‚     â””â”€ Detecta FeedbackRecords          â”‚\nâ”‚                                          â”‚\nâ”‚  2. AgentDispatcher (router)            â”‚\nâ”‚     â””â”€ Busca AgentRecords matching      â”‚\nâ”‚     â””â”€ Ensambla context + knowledge     â”‚\nâ”‚                                          â”‚\nâ”‚  3. LocalRunner (execution)             â”‚\nâ”‚     â””â”€ Dynamic import agentes TS        â”‚\nâ”‚                                          â”‚\nâ”‚  4. Agents (cli-designer, module)       â”‚\nâ”‚     â””â”€ Ejecuta auditorÃ­a con LLM        â”‚\nâ”‚     â””â”€ Genera FeedbackRecord respuesta  â”‚\nâ”‚                                          â”‚\nâ”‚  5. Integration (OpenCode/Anthropic)    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Flujo:**\n```\nFeedbackRecord (assignee: agent:cli-designer)\n    â†“\nAgentWatcher detecta â†’ Busca AgentRecord\n    â†“\nAgentRecord.triggers matchea \"feedback.created\"\n    â†“\nLocalRunner ejecuta con knowledge_dependencies\n    â†“\nAgente audita + genera reporte\n    â†“\nCrea FeedbackRecord con resultado\n```\n\n---\n\n## ğŸ¯ Alcance Fase 1 (MVP)\n\n### **Entregables:**\n\n1. **AgentWatcher** (`packages/platform/src/orchestrator/agent-watcher.ts`)\n   - Monitor `.gitgov/feedback/` con chokidar\n   - Trigger detection + dispatch\n\n2. **AgentDispatcher** (`packages/platform/src/orchestrator/agent-dispatcher.ts`)\n   - Registry de agentes\n   - Blueprint path extraction\n   - Context assembly\n\n3. **LocalRunner** (`packages/platform/src/orchestrator/runners/local-runner.ts`)\n   - Dynamic import TypeScript agents\n   - Error handling + timeouts\n\n4. **CLI Designer Agent** (`packages/platform/src/agents/cli-designer/cli-designer.ts`)\n   - AuditorÃ­a con 5 criterios\n   - IntegraciÃ³n OpenCode/Anthropic\n   - GeneraciÃ³n FeedbackRecord\n\n5. **CLI Command** (`gitgov agent watch`)\n   - Inicia watcher\n   - Daemon mode\n   - Logging\n\n6. **AgentRecord Manifests**\n   - `.gitgov/agents/agent-cli-designer.json`\n   - `.gitgov/agents/agent-module-designer.json`\n\n### **Criterios de Ã‰xito:**\n\n- âœ… Usuario crea FeedbackRecord con assignee agente\n- âœ… Watcher detecta automÃ¡ticamente\n- âœ… AuditorÃ­a completa en <2 minutos\n- âœ… Reporte con scoring X.X/10\n- âœ… Sistema 100% local (sin cloud)\n\n### **NO Incluido Fase 1:**\n\n- âŒ APIRunner / MCPRunner\n- âŒ Docker/GCP deployment\n- âŒ Multi-agent workflows\n- âŒ Scheduling (cron)\n\n---\n\n## ğŸ”§ ImplementaciÃ³n\n\n### **AgentRecord Manifest Ejemplo:**\n\n```json\n{\n  \"id\": \"agent:cli-designer\",\n  \"status\": \"active\",\n  \"triggers\": [{\n    \"type\": \"webhook\",\n    \"event\": \"feedback.created\",\n    \"filter\": {\n      \"assignee\": \"agent:cli-designer\",\n      \"type\": [\"assignment\", \"question\"]\n    }\n  }],\n  \"knowledge_dependencies\": [\n    \"packages/blueprints/02_agents/design/cli_designer_v2.md\",\n    \"packages/blueprints/03_products/cli/specs/**/*.md\"\n  ],\n  \"engine\": {\n    \"type\": \"local\",\n    \"runtime\": \"typescript\",\n    \"entrypoint\": \"packages/platform/src/agents/cli-designer/cli-designer.ts\",\n    \"function\": \"auditBlueprint\"\n  },\n  \"metadata\": {\n    \"framework\": \"opencode\",\n    \"model\": \"claude-3-5-sonnet-20241022\",\n    \"audit_criteria\": 5,\n    \"min_score_threshold\": 9.0\n  }\n}\n```\n\n### **CLI Designer Agent:**\n\n```typescript\nexport async function auditBlueprint(context: FullAgentContext): Promise<AgentResult> {\n  // 1. Extraer blueprint path del feedback\n  const blueprintPath = extractBlueprintPath(context.feedback.payload.content);\n  \n  // 2. Leer blueprint + agent prompt\n  const blueprintContent = await readFile(blueprintPath);\n  const agentPrompt = context.knowledge['cli_designer_v2.md'];\n  \n  // 3. Ejecutar auditorÃ­a con LLM (OpenCode o Anthropic)\n  const auditReport = await runAuditWithLLM({\n    agentPrompt,\n    blueprint: blueprintContent,\n    model: context.metadata.model\n  });\n  \n  // 4. Parsear scoring\n  const score = extractScore(auditReport); // â†’ 9.2\n  \n  // 5. Crear FeedbackRecord respuesta\n  await feedbackAdapter.create({\n    entityType: 'feedback',\n    entityId: context.feedback.header.id,\n    type: score >= 9.0 ? 'approval' : 'suggestion',\n    status: score >= 9.0 ? 'resolved' : 'open',\n    content: auditReport,\n    resolvesFeedbackId: context.feedback.header.id\n  }, 'agent:cli-designer');\n  \n  return { success: true, output: auditReport };\n}\n```\n\n---\n\n## ğŸ“ Arquitectura de Archivos\n\n```\npackages/\nâ”œâ”€â”€ platform/                    # â† NUEVO\nâ”‚   â”œâ”€â”€ src/\nâ”‚   â”‚   â”œâ”€â”€ orchestrator/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ agent-watcher.ts\nâ”‚   â”‚   â”‚   â”œâ”€â”€ agent-dispatcher.ts\nâ”‚   â”‚   â”‚   â”œâ”€â”€ local-agent-orchestrator.ts\nâ”‚   â”‚   â”‚   â””â”€â”€ runners/\nâ”‚   â”‚   â”‚       â””â”€â”€ local-runner.ts\nâ”‚   â”‚   â”œâ”€â”€ agents/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ cli-designer/\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cli-designer.ts\nâ”‚   â”‚   â”‚   â”‚   â””â”€â”€ manifest.json\nâ”‚   â”‚   â”‚   â””â”€â”€ module-designer/\nâ”‚   â”‚   â”‚       â”œâ”€â”€ module-designer.ts\nâ”‚   â”‚   â”‚       â””â”€â”€ manifest.json\nâ”‚   â”‚   â””â”€â”€ integrations/\nâ”‚   â”‚       â”œâ”€â”€ opencode.ts\nâ”‚   â”‚       â””â”€â”€ anthropic.ts\nâ”‚   â””â”€â”€ package.json\nâ”‚\nâ””â”€â”€ cli/src/commands/agent/      # â† NUEVO\n    â”œâ”€â”€ agent-command.ts\n    â”œâ”€â”€ watch.ts\n    â”œâ”€â”€ list.ts\n    â””â”€â”€ show.ts\n```\n\n---\n\n## ğŸ¯ Plan ImplementaciÃ³n\n\n### **Sprint 1: Fundamentos (Semana 1)**\n1. Setup package @gitgov/platform\n2. AgentWatcher bÃ¡sico (chokidar)\n3. AgentDispatcher (registry + routing)\n\n**Deliverables:** Watcher detecta FeedbackRecords\n\n### **Sprint 2: Execution (Semana 2)**\n1. LocalRunner (dynamic import)\n2. LocalAgentOrchestrator (context assembly)\n3. AgentRecord manifests\n\n**Deliverables:** Runner ejecuta agentes TypeScript\n\n### **Sprint 3: CLI Designer (Semana 3)**\n1. cli-designer.ts agent\n2. OpenCode/Anthropic integration\n3. FeedbackRecord generation\n\n**Deliverables:** AuditorÃ­a end-to-end exitosa\n\n### **Sprint 4: CLI + Testing (Semana 4)**\n1. `gitgov agent watch` command\n2. Integration tests\n3. DocumentaciÃ³n\n\n**Deliverables:** Sistema completo funcional\n\n---\n\n## ğŸ“Š MÃ©tricas de Ã‰xito\n\n| MÃ©trica | Target |\n|---------|--------|\n| **Tiempo auditorÃ­a** | <2 minutos |\n| **PrecisiÃ³n scoring** | Â±0.5 vs manual |\n| **Test coverage** | >80% |\n| **Memory usage** | <512MB |\n| **Uptime** | >99% |\n\n---\n\n## ğŸš€ Fases Futuras\n\n### **Fase 2: Multi-Engine (Mes 2)**\n- APIRunner / MCPRunner\n- Docker deployment\n- Agent-to-agent communication\n\n### **Fase 3: Cloud (Mes 3)**\n- GCP Cloud Run\n- Pub/Sub triggers\n- Monitoring\n\n### **Fase 4: Advanced (Mes 4+)**\n- Multi-agent workflows (LangGraph)\n- Scheduled triggers\n- Web dashboard\n\n---\n\n## ğŸ“š Referencias\n\n**Herramientas AI:**\n- OpenCode: https://opencode.ai/ (30K stars, terminal TUI)\n- Aider: https://aider.chat (Git-aware)\n- CrewAI: https://docs.crewai.com/ (Multi-agent)\n- LangGraph: https://langchain-ai.github.io/langgraph/ (Workflows)\n\n**Blueprints:**\n- `packages/blueprints/02_agents/design/cli_designer_v2.md`\n- `packages/blueprints/02_agents/design/module_designer_v2.md`\n- `packages/blueprints/03_products/platform/platform_tech_design.md`\n- `packages/blueprints/03_products/protocol/03_agent/agent_record_schema.yaml`\n\n---\n\n## âœ… Definition of Done\n\n**Funcionales:**\n- [ ] `gitgov agent watch` inicia correctamente\n- [ ] Watcher detecta FeedbackRecords con assignee agent\n- [ ] Agente ejecuta auditorÃ­a en <2 minutos\n- [ ] Reporte incluye scoring (X.X/10) + 5 criterios\n- [ ] Crea FeedbackRecord respuesta vÃ¡lido\n- [ ] Error handling completo\n- [ ] 1+ blueprint auditado end-to-end\n\n**No Funcionales:**\n- [ ] Test coverage >80%\n- [ ] Zero TypeScript `any`\n- [ ] ESLint compliance\n- [ ] DocumentaciÃ³n completa\n- [ ] Performance <2 min\n- [ ] Memory <512MB\n\n---\n\n## ğŸ’¡ Decisiones Pendientes\n\n1. **AI Backend:** OpenCode (TUI) vs Anthropic API (simple)?\n   - **Propuesta:** Anthropic API â†’ OpenCode despuÃ©s\n\n2. **Error Strategy:** Â¿Retry o notificar humano?\n   - **Propuesta:** FeedbackRecord tipo \"blocking\"\n\n3. **Rate Limiting:** Â¿Max auditorÃ­as/hora?\n   - **Propuesta:** 10/hora en MVP\n\n4. **Agent Registry:** Â¿.gitgov/agents/ o DB?\n   - **Propuesta:** .gitgov/agents/ (consistencia)\n\n---\n\n**Valor Inmediato:** 1 hora â†’ 2 minutos review time\n\n**Valor EstratÃ©gico:** FundaciÃ³n sistema agentes extensible\n\n**Complejidad:** Alta (4-6 semanas)\n\n**Prioridad:** High\n\n**Tags:** agents, automation, ai-integration, platform, phase-1",
    "tags": [
      "agents",
      "automation",
      "ai-integration",
      "platform",
      "phase-1"
    ],
    "references": [],
    "cycleIds": [
      "1763344784-cycle-tareas-hurfanas-consolidadas"
    ]
  }
}